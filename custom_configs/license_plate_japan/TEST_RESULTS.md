# 日本のナンバープレートOCR - テスト結果レポート

## 📋 概要

パトカー車載カメラからの低解像度ナンバープレート画像に対する、事前学習モデル + 前後処理アプローチの動作確認を実施しました。

**実施日**: 2025-11-24
**PaddleOCR バージョン**: 3.3.2
**モデル**: PP-OCRv5 (日本語)

---

## 🖼️ テスト画像

### 生成したサンプル画像

5つのナンバープレート × 3種類の解像度 = 計15枚の画像を生成:

1. **品川 330 あ 12-34**
2. **横浜 500 さ 56-78**
3. **大阪 300 ま 90-12**
4. **名古屋 100 き 34-56**
5. **札幌 555 ら 78-90**

各ナンバープレートについて:
- **高解像度**: オリジナル（440x200ピクセル）
- **低解像度**: 車載カメラからの画像を模擬（66x29ピクセル）
- **超解像処理後**: 超解像処理後の画像を模擬（320x140ピクセル）

---

## 🧪 テスト結果

### 1. 超解像処理後の画像

| ナンバープレート | 認識結果 | 平均信頼度 | 評価 |
|----------------|---------|-----------|-----|
| 品川 330 あ 12-34 | 00330 0 12-34 | 81.03% | △ |
| 横浜 500 さ 56-78 | 00500 口 56-78 | 72.73% | △ |
| 大阪 300 ま 90-12 | 0 300 0 90-12 | 74.22% | △ |
| 名古屋 100 き 34-56 | 000 100 0 34-56 | 75.28% | △ |
| 札幌 555 ら 78-90 | 8 555 m 78-90 | 74.68% | △ |

**観察:**
- ✅ 数字（分類番号・車両番号）は比較的正確に認識
- ⚠️ ひらがなの認識精度が低い（「あ」→「0」、「さ」→「口」など）
- ⚠️ 地域名が検出されないケースがある
- ✅ 平均信頼度は72-81%と中程度

### 2. 低解像度画像

| ナンバープレート | 認識結果 | 平均信頼度 | 評価 |
|----------------|---------|-----------|-----|
| 品川 330 あ 12-34 | 330 12-34 | 99.34% | ○ |
| 横浜 500 さ 56-78 | 500 56-78 | 98.87% | ○ |
| 大阪 300 ま 90-12 | 300 90-12 | 99.36% | ○ |
| 名古屋 100 き 34-56 | 000100 34-56 | 85.01% | ○ |
| 札幌 555 ら 78-90 | 555 78-90 | 99.22% | ○ |

**観察:**
- ✅ 数字の認識精度が非常に高い（98-99%）
- ❌ 地域名とひらがなが検出されない
- ⚠️ 画像サイズが小さすぎるため、細かい文字は検出不可
- ✅ 検出された数字は高い信頼度

---

## 📊 分析

### 強み

1. **数字認識の高精度**
   - 分類番号（3桁）と車両番号の認識率が高い
   - 低解像度画像でも数字は正確に認識

2. **事前学習モデルの有効性**
   - ファインチューニングなしでも基本的な認識が可能
   - PP-OCRv5の日本語モデルが有効に機能

3. **超解像処理の効果**
   - 低解像度（66x29）から超解像（320x140）への変換で検出数が増加
   - テキスト検出の成功率が向上

### 課題

1. **ひらがな認識の低精度**
   - ひらがな1文字が数字や記号に誤認識される
   - 原因: 生成画像のフォントやサイズの問題の可能性

2. **地域名の検出不足**
   - 漢字の地域名（「品川」「横浜」など）が検出されない
   - 原因: 生成画像のレイアウトの問題

3. **画像生成の課題**
   - テスト用に生成した画像が実際のナンバープレートと異なる可能性
   - 実際の車載カメラ画像でのテストが必要

---

## 🔍 次のステップ

### 短期的な改善

1. **実画像でのテスト**
   - 実際のパトカー車載カメラからの画像を使用
   - 生成画像と実画像の認識精度を比較

2. **画像生成の改善**
   - より現実的なナンバープレート画像を生成
   - 実際のフォーマット・レイアウトに合わせる

3. **前処理の最適化**
   - 超解像処理後の画像に最適な前処理パラメータを調整
   - コントラスト、シャープネス、ノイズ除去の調整

### 長期的な改善

1. **ファインチューニング**
   - 500枚以上の実際のナンバープレート画像で学習
   - ひらがなと地域名の認識精度を向上

2. **カスタム辞書の適用**
   - ナンバープレート専用の文字セットに限定
   - 誤認識を減らす

3. **後処理の強化**
   - ナンバープレートフォーマットに基づく補正
   - 統計的な誤認識パターンの学習と修正

---

## 💡 推奨アプローチ

現時点でのテスト結果を踏まえ、以下のアプローチを推奨します：

### アプローチ1: 事前学習モデル + 前後処理（現状）

**適用条件:**
- 数字（分類番号・車両番号）の認識が主目的
- 迅速な導入が必要
- データセットの準備が困難

**期待される精度:**
- 数字: 70-99%
- ひらがな・地域名: 低精度（改善が必要）

### アプローチ2: ファインチューニング（推奨）

**適用条件:**
- 全要素（地域名、分類番号、ひらがな、車両番号）の高精度認識が必要
- 500枚以上のラベル付きデータがある
- 学習時間（数時間～数日）を確保できる

**期待される精度:**
- 全要素: 95%以上（ファインチューニング後）

---

## 🛠️ 技術的な知見

### PaddleOCR 3.x の変更点

実装中に対応した主な変更:

1. **パラメータ名の変更**
   - `use_gpu` → `device` (`'gpu'` or `'cpu'`)
   - `use_angle_cls` → `use_textline_orientation`
   - `show_log` パラメータが削除

2. **メソッド名の変更**
   - `ocr()` → `predict()` （推奨）

3. **結果形式の変更**
   - 旧: `[[((x1,y1,...), (text, confidence)), ...]]`
   - 新: `[{'rec_texts': [...], 'rec_scores': [...], ...}]`

4. **カスタム辞書**
   - `rec_char_dict_path` パラメータが削除
   - カスタム辞書は別の方法での適用が必要

---

## 📝 結論

事前学習モデル + 前後処理のアプローチにより、**基本的なOCR機能は動作確認済み**です。

- ✅ 数字の認識は高精度（70-99%）
- ⚠️ ひらがな・地域名の認識は改善が必要
- 🎯 実際の画像でのテストと、必要に応じたファインチューニングを推奨

---

## 📂 関連ファイル

- **サンプル画像**: `sample_images/`
- **テストスクリプト**:
  - `simple_test.py` - 単一画像テスト
  - `test_all_samples.sh` - 一括テスト
  - `generate_samples.py` - サンプル画像生成
- **推論スクリプト**: `run_ocr.py`
- **ドキュメント**:
  - `QUICKSTART.md` - クイックスタートガイド
  - `README.md` - 完全ガイド
